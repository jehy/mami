<nav class="col-xs-3 bs-docs-sidebar">
    <ul id="sidebar" class="nav nav-stacked fixed col-xs-3">
        <li><a href="#guide">Инструкция</a></li>
    </ul>
</nav>
<div class="col-xs-9">
    <section id="intro" class="group">
        <h1>Установка DVWA</h1>

        Установить данное приложение для тестирования можно несколькими способами:
        <ul>
            <li>В основную систему на вашу имеющуюся веб экосистему - в xampp, denver, или отдельно настроенные
                php+mysql+любой произвольный веб сервер (MS IIS, Apache, Nginx);
            </li>
            <li>В гостевую систему к Kali;</li>
            <li>На отдельную виртуальную машину.</li>
        </ul>
        <p>На какой либо внешний сервер DVWA ставить не рекомендуется, так как оно "чертовски уязвимо", и будет
            угрожать безопасности этого веб сервера. Разумнее устанавливать приложение для тестирования в
            гостевую систему к kali, а ещё лучше - в отдельную виртуальную машину. В последнем случае мы можем
            предоставить приложению любое требуемое ему окружения и безболезненно делать downgrade любых пакетов
            без ущерба для других компонентов. К примеру, если вы занимаетесь тестированием веб приложений, то
            вполне вероятно, что вам потребуется с десяток виртуальных машин с веб серверами на разных
            платформах и разными версиями пакетов (например, разнообразные комбинации Windows, Linux, Apache,
            Nginx, PHP, MySQL).</p>
        <p>Для начала переместимся в директорию для сайтов:</p>
        <pre class="prettyprint lang-bash">
cd /var/www</pre>
        <p>Далее скачаем последнюю версию из репозитория</p>
        <pre class="prettyprint lang-bash">wget https://github.com/jehy-security/DVWA/archive/master.zip</pre>
        <p>Можно склонировать репозиторий при помощи git, но нам на самом интересует только последняя версия
            приложения, так что это необязательно.</p>
        <p>Далее нужно разархивировать скачанный файл:</p>
        <pre class="prettyprint lang-bash">unzip ./master.zip</pre>
        <p>Теперь переименуем папку, чтобы было удобнее использовать её путь:</p>
        <pre class="prettyprint lang-bash">mv ./DVWA-master/ dvwa</pre>
        <p>Далее нужно, чтобы Apache узнал о том, что у нас есть такой веб сайт. Сделаем его сайтом по
            умолчанию, который слушает 127.0.0.1. Открываем настройку сайта по умолчанию и меняем DocumentRoot с
            /var/www/html на /var/www/dvwa. Можно для этого использовать mcedit (утилита для редактирования
            файлов, включённая в состав Midnight Commander), или любой другой текстовый редактор, в том числе с
            графической оболочкой - например, LeafPad, включенный в Kali Linux.</p>
        <pre class="prettyprint lang-bash">mcedit /etc/apache2/sites-available/000-default.conf</pre>
        <p>Отлично! Осталось запустить Apache с применёнными изменениями:</p>
        <pre class="prettyprint lang-bash">systemctl restart apache2</pre>
        <p>Так же нужно запустить MySQL, который по умолчанию выключен:</p>
        <pre class="prettyprint lang-bash">systemctl start mysql</pre>
        <p>Отлично! Теперь, открыв встроенный в Kali браузер (Firefox), вы можете ввести адрес 127.0.0.1 и
            увидеть следующую страницу:</p>
        <img src="img/infosec-lab8/dvwa-setup.jpg">
        <p>Неплохо, однако так у нас ничего работать не будет. Пойдём по проблемам сверху вниз:</p>
        <p>"PHP function allow_url_include: Disabled" - идём в файл настроек PHP </p>
        <pre class="prettyprint lang-bash">mcedit /etc/php/7.0/apache2/php.ini</pre>
        <p>И включаем там флаг allow_url_include, делая наше приложение более уязвимым.</p>
        <p>Далее нужно поставить модуль php gd. Для этого сначала мы обновим базу данных репозиториев, затем
            поставим этот пакет:</p>
        <pre class="prettyprint lang-bash">apt-get update
apt-get install php-gd
Y</pre>
        <p>В процессе установки, скрипт установщик может вас спросить, не хотите ли вы обновить свой файл
            настроек PHP на стандартный. Нет, вы не хотите - нужно оставить локальную копию. После установки
            для применения изменений нужно перезапустить apache:</p>
        <pre class="prettyprint lang-bash">systemctl restart apache2</pre>
        <p>Далее мы видим, что приложение использует некий свой пароль для подключения из под пользователя root
            к базе MySQL. Подключаться из-под root это плохая практика - но на это у нас и "чертовски уязвимое
            приложение". Так что добавим дыр, убрав пароль для root пользователя MySQL в файле настроек
            приложения:</p>
        <pre class="prettyprint lang-bash">mcedit /var/www/dvwa/config/config.inc.php</pre>
        <p>Наше приложение так же будет использовать сервис reCAPTCHA. Для этого ему понадобятся ключи для этого
            сервиса, которые можно получить по <a href="https://www.google.com/recaptcha/admin?hl=ru">этому
                адресу</a> и добавить в тот же файл настроек приложения, которые мы только что редактировали.
        </p>
        <p>Ну и наконец нам нужно выдать права на запись файлов. Если бы мы настраивали нормальное приложение,
            то создали бы для него специального пользователя, дали бы права apache читать и писать файлы этой
            группы... Но так как мы говорим о чертовски уязвимом приложении, то логично будет сделать
            максимально неправильно:
        </p>
        <pre class="prettyprint lang-bash">cd /var/www/dvwa/
chmod 777 . -R</pre>
        <p>И этим самам мы дали возможность кому угодно читать, писать и испольнять файлы приложения.
        </p>
        <p>Так же вы можете заметить ошибку "PHP module mysql: Missing" - но это старое наследие и текущая
            версия приложения успешно работает без расширения mysql, которое запрещено в PHP в версии от 7. Если
            бы нам пришлось включать это расширение, то пришлось бы ставить PHP более старой версии примерно <a
                    href="http://askubuntu.com/questions/756181/installing-php-5-6-on-xenial-16-04">вот так</a>,
            что не сложно, но нам не требуется в данном случае.
        </p>
        <p>Если всё выполнено - нажимаем кнопку - "create/reset database", и попадаем в форму ввода пароля, где
            вводим admin/password и можем наконец приступить к тестированию.
        </p>


    </section>
</div>
